<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ma sélection de Némo</title>
<style>
body {
    font-family: Arial, sans-serif;
    background-color: #f0f8ff;
    text-align: center;
    padding: 20px;
}
h1 {
    color: #ff4500;
    font-size: 3em;
    margin-bottom: 30px;
}
input, button {
    margin: 10px;
    padding: 10px;
    font-size: 1em;
}
img.converted {
    max-width: 80%;
    margin-top: 20px;
    border-radius: 10px;
}
#errorMsg {
    color: red;
    font-weight: bold;
}
</style>
</head>
<body>

<h1>Ma sélection de Némo</h1>

<div id="home">
    <p>Bienvenue ! Utilisez <code>#create</code> dans l'URL pour créer votre image texte.</p>
</div>

<div id="createSection" style="display:none;">
    <h2>Convertir une image en texte</h2>
    <input type="file" id="imageInput" accept="image/*"><br>
    <button onclick="convertImage()">Convertir en texte</button>
    <p id="errorMsg"></p>
    <a id="downloadLink" style="display:none;">Télécharger le fichier image.txt</a>
    <h3>Ou reconvertir un fichier texte en image :</h3>
    <input type="file" id="textInput" accept=".txt"><br>
    <button onclick="convertTextToImage()">Afficher l'image</button>
    <div id="imageOutput"></div>
</div>

<script>
// Vérifier l'URL pour afficher #create
if(window.location.hash === '#create'){
    document.getElementById('home').style.display = 'none';
    document.getElementById('createSection').style.display = 'block';
}

// Convertir l'image en Base64 et vérifier la taille
function convertImage(){
    const file = document.getElementById('imageInput').files[0];
    const errorMsg = document.getElementById('errorMsg');
    errorMsg.textContent = '';
    if(!file) return alert("Veuillez choisir une image.");

    const reader = new FileReader();
    reader.onload = function(e){
        const base64Data = e.target.result.split(',')[1]; // Supprime le préfixe data:image

        // Vérification taille Base64
        const sizeInBytes = Math.ceil(base64Data.length * 3 / 4); // Conversion Base64 -> taille réelle approximative
        if(sizeInBytes > 1 * 1024 * 1024){ // 1 Mo
            errorMsg.textContent = "Erreur : le fichier généré dépasse 1 Mo. Choisissez une image plus petite.";
            document.getElementById('downloadLink').style.display = 'none';
            return;
        }

        const blob = new Blob([base64Data], {type: 'text/plain'});
        const url = URL.createObjectURL(blob);

        const link = document.getElementById('downloadLink');
        link.href = url;
        link.download = 'image.txt';
        link.style.display = 'inline';
        link.textContent = 'Télécharger image.txt';
        alert("Image convertie en texte ! Téléchargez le fichier image.txt");
    }
    reader.readAsDataURL(file);
}

// Reconversion du texte en image
function convertTextToImage(){
    const file = document.getElementById('textInput').files[0];
    if(!file) return alert("Veuillez choisir un fichier texte.");

    const reader = new FileReader();
    reader.onload = function(e){
        const base64Data = e.target.result;
        const img = document.createElement('img');
        img.src = 'data:image/jpeg;base64,' + base64Data;
        img.className = 'converted';

        const output = document.getElementById('imageOutput');
        output.innerHTML = '';
        output.appendChild(img);
    }
    reader.readAsText(file);
}
</script>

</body>
</html>
